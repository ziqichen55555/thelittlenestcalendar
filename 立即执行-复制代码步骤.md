# 🚀 立即执行 - 复制代码到 Google Apps Script

## ✅ 代码已确认正确

你提供的代码包含：
- ✅ `doOptions` 函数（在文件开头）
- ✅ `doGet` 函数
- ✅ `doPost` 函数
- ✅ 所有功能（添加、更新、删除、清空）

## 📋 执行步骤（5 分钟）

### 步骤 1：打开 Google Apps Script

1. 访问：https://script.google.com/
2. 选择你的项目（The Little Nest Calendar）

### 步骤 2：清空现有代码

1. 在代码编辑器中
2. 按 `Ctrl+A` (Windows) 或 `Cmd+A` (Mac) 选中所有代码
3. 按 `Delete` 删除所有代码

### 步骤 3：粘贴新代码

1. **复制你刚才提供的完整代码**（从 `// ============================================` 开始到最后一行）
2. **粘贴到 Google Apps Script 编辑器**（`Ctrl+V` 或 `Cmd+V`）

### 步骤 4：确认代码结构

确认代码按以下顺序：
1. ✅ `const SHEET_NAME = "thelittlenestbookings";`
2. ✅ `function doOptions() { ... }` （在文件最前面！）
3. ✅ `function doGet() { ... }`
4. ✅ `function doPost(e) { ... }`

### 步骤 5：保存代码

1. 点击 **"保存"** 按钮（💾 图标）
2. 或按 `Ctrl+S` (Windows) / `Cmd+S` (Mac)
3. 确认没有错误提示（红色错误信息）

### 步骤 6：重新部署（重要！）

1. 点击 **"部署"** → **"管理部署"**
2. 找到现有的部署，点击 **"编辑"**（铅笔图标）
3. 在 **"版本"** 下拉菜单中选择 **"新版本"**
4. **重要**：确认 **"具有访问权限的用户"** 设置为 **"所有人"**
5. 点击 **"部署"** 按钮
6. **等待部署完成**（几秒钟）
7. **复制新的 Web App URL**（如果需要更新应用代码）

### 步骤 7：等待并测试

1. **等待 10-20 秒**让部署生效
2. **刷新你的日历应用页面**：
   - 访问：https://ziqichen55555.github.io/thelittlenestcalendar/
   - 硬刷新：`Ctrl+Shift+R` (Windows) 或 `Cmd+Shift+R` (Mac)
3. **测试功能**：
   - 尝试添加一个预订
   - 尝试删除一个预订
   - 查看是否还有 CORS 错误

## ✅ 验证清单

完成所有步骤后，确认：

- [ ] 代码已完全替换（旧代码已删除）
- [ ] `doOptions` 函数在文件最前面
- [ ] 代码已保存（没有错误）
- [ ] 已重新部署为新版本
- [ ] "具有访问权限的用户" = "所有人"
- [ ] 已等待 10-20 秒
- [ ] 已刷新应用页面（硬刷新）
- [ ] 添加/删除功能不再出现 CORS 错误

## 🎯 如果还是出现 CORS 错误

### 检查 1：确认 doOptions 函数存在

1. 在 Google Apps Script 编辑器中
2. 按 `Ctrl+F` 或 `Cmd+F` 搜索
3. 搜索：`doOptions`
4. 如果找不到，说明代码没有正确粘贴

### 检查 2：确认部署设置

1. 点击 "部署" → "管理部署"
2. 确认 "具有访问权限的用户" = "所有人"
3. 确认使用的是最新版本

### 检查 3：清除浏览器缓存

1. 硬刷新：`Ctrl+Shift+R` 或 `Cmd+Shift+R`
2. 或使用无痕模式测试

## 📞 需要帮助？

如果按照上述步骤操作后仍然有 CORS 错误，请提供：

1. **Google Apps Script 代码截图**（显示前 20 行，确认有 `doOptions` 函数）
2. **部署设置截图**（显示 "具有访问权限的用户"）
3. **浏览器控制台的完整错误信息**

这样我可以帮你进一步诊断问题。


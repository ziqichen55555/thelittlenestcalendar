# 📋 如何查看 Google Apps Script 执行日志

## 🔍 查看日志的步骤

### 方法 1：在 Google Apps Script 编辑器中查看

1. **打开 Google Apps Script：** https://script.google.com/
2. **选择你的项目**
3. **点击左侧菜单的 "执行"**（或 "Executions"）
4. **查看执行日志：**
   - 会显示所有函数的执行记录
   - 包括执行时间、状态、日志输出
5. **点击某个执行记录**，查看详细的日志输出

### 方法 2：使用 Logger 查看

1. **在代码中添加 `Logger.log()` 语句**（已在代码中添加）
2. **执行函数后，点击 "执行" → "查看" → "日志"**
3. **或使用快捷键：** `Ctrl+Enter` (Windows) 或 `Cmd+Enter` (Mac)

### 方法 3：实时查看日志

1. **在 Google Apps Script 编辑器中**
2. **点击 "执行" → "查看" → "日志"**
3. **或使用快捷键：** `Ctrl+Enter` (Windows) 或 `Cmd+Enter` (Mac)
4. **日志会实时显示**（需要先执行函数）

## 📊 日志内容说明

代码中已添加以下日志：

### doOptions 函数
- `=== doOptions 被调用 ===` - 确认函数被调用
- `时间: ...` - 调用时间
- `请求方法: OPTIONS` - 请求类型
- `✅ doOptions 执行成功` - 执行成功
- `❌ doOptions 执行失败: ...` - 执行失败（如果有错误）

### doGet 函数
- `=== doGet 被调用 ===` - 确认函数被调用
- `时间: ...` - 调用时间
- `📊 工作表数据行数: ...` - 数据行数
- `✅ doGet 成功，返回 X 条记录` - 成功返回

### doPost 函数
- `=== doPost 被调用 ===` - 确认函数被调用
- `时间: ...` - 调用时间
- `📝 操作类型: ...` - 操作类型（add/update/delete/clearAll）
- `📝 请求数据: ...` - 请求数据
- `➕ 添加记录，ID: ...` - 添加操作
- `✏️ 更新记录，ID: ...` - 更新操作
- `🗑️ 删除记录，ID: ...` - 删除操作
- `🧹 清空所有数据` - 清空操作

## 🔍 如何测试 doOptions 是否被调用

### 步骤 1：复制代码并部署

1. 复制 `完整代码-最终版本.js` 中的完整代码
2. 粘贴到 Google Apps Script 编辑器
3. 保存代码
4. 重新部署（选择 "新版本"）

### 步骤 2：触发 OPTIONS 请求

1. 打开验证工具：
   ```
   https://ziqichen55555.github.io/thelittlenestcalendar/验证WebApp部署.html
   ```
2. 点击 "测试 OPTIONS 请求" 按钮

### 步骤 3：查看日志

1. 在 Google Apps Script 编辑器中
2. 点击 "执行" → 查看执行记录
3. 找到最近的执行记录
4. 点击查看详细日志
5. **查找：** `=== doOptions 被调用 ===`

### 如果看到 doOptions 日志

✅ **说明：** `doOptions` 函数已被调用，但可能返回的响应有问题

### 如果看不到 doOptions 日志

❌ **说明：** `doOptions` 函数未被调用，可能是：
- 部署版本未更新
- Web App URL 指向了错误的项目
- 浏览器缓存问题

## 💡 调试技巧

1. **添加更多日志：** 在关键位置添加 `Logger.log()` 语句
2. **查看执行时间：** 确认日志时间与请求时间一致
3. **检查错误信息：** 如果有错误，日志会显示错误详情
4. **对比 GET 和 POST：** 如果 GET 有日志但 OPTIONS 没有，说明 OPTIONS 未被调用

## 🆘 常见问题

### Q: 看不到日志？

**A:** 
1. 确认代码已保存
2. 确认已重新部署
3. 确认函数已被执行（触发请求）
4. 尝试手动执行函数测试

### Q: 日志显示 doOptions 被调用，但 OPTIONS 请求仍然失败？

**A:** 
- 可能是响应格式问题
- 检查返回的 MIME 类型是否正确
- 确认 Web App 访问权限设置为 "所有人"

### Q: 如何清除旧日志？

**A:** 
- 日志会自动保留一段时间
- 可以手动删除不需要的执行记录
- 或等待自动清理


# 🔍 清理缓存和数据同步问题

## 问题

看到很多记录，但 Google Sheets 中没有。

## 可能的原因

1. **浏览器缓存了旧数据**
2. **旧的 localStorage 数据还在**
3. **数据没有正确保存到 Google Sheets**
4. **读取了错误的数据源**

## ✅ 解决方案

### 方法 1：清理浏览器缓存和 localStorage（推荐）

1. **打开浏览器控制台**（F12）
2. **运行以下命令清理 localStorage**：
   ```javascript
   localStorage.removeItem('room-bookings');
   localStorage.clear(); // 或者清理所有 localStorage
   ```
3. **清除浏览器缓存**：
   - 按 `Ctrl+Shift+Delete` (Windows) 或 `Cmd+Shift+Delete` (Mac)
   - 选择"缓存的图片和文件"
   - 点击"清除数据"
4. **硬刷新页面**：
   - `Ctrl+Shift+R` (Windows) 或 `Cmd+Shift+R` (Mac)

### 方法 2：检查实际数据源

1. **打开浏览器控制台**（F12）
2. **查看日志**：
   - 应该看到 `📡 从 Google Sheets 获取预订数据...`
   - 应该看到 `📊 获取到的原始数据（来自 Google Sheets）`
   - 如果看到 `⚠️ 发现旧的 localStorage 数据！`，说明有旧数据

3. **检查 Google Sheets**：
   - 打开你的 Google Sheet
   - 查看 `thelittlenestbookings` 工作表
   - 确认实际有多少行数据（不包括表头）

### 方法 3：验证数据是否正确保存

1. **添加一个新预订**
2. **立即检查 Google Sheets**：
   - 刷新 Google Sheet
   - 查看新预订是否出现
3. **如果新预订没有出现**：
   - 检查浏览器控制台的错误信息
   - 确认 Google Apps Script 部署设置正确

### 方法 4：强制重新加载数据

1. **打开浏览器控制台**（F12）
2. **运行以下命令**：
   ```javascript
   // 清理所有缓存
   localStorage.clear();
   sessionStorage.clear();
   
   // 强制重新加载
   location.reload(true);
   ```

## 🔍 调试步骤

### 步骤 1：检查数据源

打开浏览器控制台，查看日志：

**应该看到：**
```
📡 从 Google Sheets 获取预订数据...
📊 获取到的原始数据（来自 Google Sheets）: [...]
✓ 成功获取 X 个预订（来自 Google Sheets）
```

**如果看到：**
```
⚠️ 发现旧的 localStorage 数据！
```
说明有旧的 localStorage 数据，需要清理。

### 步骤 2：对比数据

1. **查看应用显示的预订数量**
2. **查看 Google Sheets 中的实际行数**（不包括表头）
3. **如果数量不一致**：
   - 应用显示的数量 > Google Sheets：可能是缓存问题
   - 应用显示的数量 < Google Sheets：可能是读取问题

### 步骤 3：检查 Google Sheets

1. **打开 Google Sheet**
2. **检查工作表名称**：应该是 `thelittlenestbookings`
3. **检查表头**：第一行应该是 `ID, StartDate, EndDate, GuestsNo, Note, Color`
4. **检查数据行**：从第二行开始是数据

## 🛠️ 快速修复命令

在浏览器控制台运行：

```javascript
// 1. 清理所有 localStorage
localStorage.clear();

// 2. 检查是否还有旧数据
console.log('room-bookings:', localStorage.getItem('room-bookings'));

// 3. 强制重新加载
location.reload(true);
```

## 📝 验证

清理后：
1. **刷新页面**
2. **查看控制台日志**：
   - 应该看到从 Google Sheets 获取的数据
   - 不应该看到 localStorage 警告
3. **对比数据**：
   - 应用显示的预订数量应该和 Google Sheets 中的行数一致

## ❓ 如果还是不对

如果清理后数据还是不对：

1. **检查 Google Apps Script**：
   - 确认 `doGet` 函数正确
   - 确认工作表名称是 `thelittlenestbookings`

2. **检查网络请求**：
   - 打开浏览器开发者工具 → Network 标签
   - 刷新页面
   - 查看对 Google Script URL 的请求
   - 查看响应内容

3. **提供信息**：
   - 浏览器控制台的完整日志
   - Google Sheets 中的实际数据截图
   - Network 标签中的请求和响应

